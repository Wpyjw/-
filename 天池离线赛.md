## 赛题介绍：
利用训练数据包含了抽样出来的一定量用户在一个月时间（11.18~12.18）之内的移动端行为数据（D）。
评分数据是这些用户在这个一个月之后的一天（12.19）对商品子集（P）的购买数据。
输出结果：user_id,item_id.
结果评价：F1=2PR/P+R,Precision=预测集与参考集的交集/预测集，Recall=预测集与参考集的交集/参考集。

## 数据解析
移动端行为数据集D 大小10M 60W条记录 用户商品行为数据 （user_id,item_id,behavior_type（1,2,3,4 浏览、收藏、加购物车、购买）,user_geohash,item_category,time）
商品子集P 大小1G 2000W条样本 数据过大，采用抽样分析，分块操作 商品数据（item_id,item_geohash_item_category）
对数据进行解析：发现每日操作次数中12.12日数据异常，其他日期数据总体平稳。进一步观察两天的数据，发现每个小时的行为趋势类似。
因此剔除12.12数据。
### 数据处理
1.由于用户行为对购买的影响随时间减弱，根据分析，用户在一周之前的行为对考察日是否购买的影响已经很小，故而只考虑距考察日一周以内的特征数据。  
2.分为4组数据，一组涉及双12异常期，舍去  
1 part 1 - train: 11.22~11.27 -> 11.28;
2 part 2 - train: 11.29~12.04 -> 12.05;
3 part 3 - pred:  12.13~12.18 (-> 12.19);

3.针对当前业务背景，考虑从user、item、item_category三大维度及其组合入手进行特征构建，简称U、I、C。
4.问题已被明确为 U-I是否发生购买行为的分类问题。如果要考虑所有可能的U-I,必将面临组合爆炸，所以只关注在距考察日一周以内出现过的U-I。

## 特征构建
六大类特征：U、I、C、UI、UC、IC、UIC
每类结合行为次数、时间、排序等视觉设计特征。
设计约100个特征。
时间粒度：n 1/3/5
特征：1 2 3 4 1234 点击购买转化率 商品的用户总数  商品的点击购买平均时差 商品在所属类别中的用户人数排序 商品在所属类型中的行为总数排序 商品在所属类型中的销量排序 

## 基于模型的预测
### 数据预处理 
正负样本失衡问题 正负样本比例为1:1200.
解决办法：对训练集中的负样本进行下采样。为避免随机采样的特征空间覆盖性不足，先对负样本进行K-means聚类，然后再每个聚类上采用下采样来获得全面的负样本，最后与正样本组成较为平衡的训练集。
缺失值处理：LR 移除缺失值
RF/GBDT： 将缺失值赋值为-1

### LR
需要对特征进行归一化，需要对负样本下采样
效果：L1评分：0.05 准确率0.06 效果不好
### 随机森林
调节参数很重要：
贪心的思路
先调试 过程参数：
RF和GBDT利用GINI指数、entropy等作为建树依据，对类别的划分具有强制作用。这类的模型对于类别失衡不敏感。但是过量冗余的负样本会严重加大训练负担。所以也考虑在不影响模型训练的前提下对数据进行采样。np_ratio=35
n_estimators: 代表随机森林中基学习器的个数 150

再调试 基学习器参数：
max_depth:10
min_samples_split（划分样本数）/min_samples_leaf(叶最小样本数):设置的小一点。
cut_off:0.8
效果：F1Score：0.98 准确率：0.09
### GBDT
-基本思想：基于CART回归树的BOOSTING模型，其核心思想是将提升过程建立在“对之前残差的负梯度表示”的回归拟合上，通过不断地迭代来实现降低偏差的目的。
-调参过程：和RF类似。
效果：F1score：0.10 准确率：0.1



## KMeans聚类解决样本失衡问题
评判指标 CHDB
计算方法：
1.随机选取K个中心点
2.遍历所有数据，将每个数据划分到最近的中心点去
3.计算每个聚类的平均值，并作为新的中心点
4.重复2-3，直到这K个中心点不再变化（收敛），或足够多的迭代次数

### 注意事项：
1.由于是利用距离计算，所以需要对特征进行0-1标准化。
2.评价指标：聚类的好坏主要看簇类紧凑、簇间离散 
CH 越大代表着类自身越紧密，类与类之间越分散  
DB
分簇的数量是1000



